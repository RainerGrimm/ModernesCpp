<div class="vorspann">Mit C++20 erhält die chrono-Bibliothek mächtige Erweiterungen. Die wichtigsten sind sicherlich die Unterstützung eines Kalenders und von Zeitzonen. Das ist aber bei weitem noch nicht alles. C++20 erhält neue Uhren, mächtige Formatierungsmöglichkeiten für Zeitdauern und einen Datentyp für die Tageszeit.</div>
<div class="text"><img class="rteInlinetag" src="https://heise-cms.de/thumbs//2/9/9/0/7/9/8/TN_201483765_4c71e89b06.png" title="<ir_inline itemname=bilder_mvp_bild_var2:1 type=2>" style="max-height: 25px; max-width: 25px;"><br></div>
<div class="text">Bevor ich in die Tiefe der erweiterten chrono-Bibliothek und insbesondere in den neuen Datentyp <span class="tx_code">std::chrono::time_of_day</span> abtauche, möchte ich erst ein paar Bemerkungen loswerden. Zuerst einmal nenne ich alle Datums- und Zeitfunktionalitäten der chrono-Bibliothek vereinfachend die Zeitbibliothek.<br></div>
<div class="ztitel">Die Zeitbibliothek in C++11<br></div>
<div class="text">Um die wesentliche Information aus meinem Artikel zur Zeitbibliothek zu erhalten, ist ein Grundverständnis der chrono-Bibliothek in C++11 erforderlich. C++11 hat drei Komponenten zum Umgang mit Zeit definiert:</div>
<div class="text"><ul><li> Ein <b>Zeitpunkt </b>(time point) wird durch einen Startpunkt [--] die sogenannte Epoche [--] und die Zeitdauer definiert.</li><li>Eine <b>Zeitdauer</b> (time duration) definiert die Differenz zwischen zwei Zeitpunkten. Sie wird durch die Anzahl der Ticks eines Zeitgebers bestimmt.</li><li>Der <b>Zeitgeber</b> (clock) besteht aus einem Startpunkt (Epoche) und seinen Ticks. Damit lässt sich der aktuelle Zeitpunkt berechnen.<br></li></ul></div>
<div class="text">Ehrlich gesagt, finde ich Zeit ein Mysterium. Einerseits besitzt jeder ein intuitives Verständnis von Zeit, andererseits ist die formale Definition von Zeit sehr anspruchsvoll. So hängen zum Beispiel die drei Komponenten Zeitpunkt, Zeitdauer und Zeitgeber voneinander ab. Wenn du mehr zur Zeitfunktionalität in C++11 lesen möchtest, hier sind meine Artikel dazu: <a alt="%7B%22text%22%3A%22time%22%2C%22user_params%22%3A%22%22%2C%22ir_link%22%3A1%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22https%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Ftag%2Ftime%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22https%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Ftag%2Ftime%22%2C%22version%22%3A1%2C%22alias%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%7D" href="https://www.grimm-jaud.de/index.php/blog/tag/time" title="Link auf https://www.grimm-jaud.de/index.php/blog/tag/time" class="">time</a>.</div>
<div class="ztitel">Die chrono-Erweiterung in C++20</div>
<div class="text">C++20 erweitert die chrono-Bibliothek um neue Komponenten:</div>
<div class="text"><ul><li>Die <b>Tageszeit</b> (time of day) ist die Zeitdauer seit Mitternacht, die in Stunden, Minuten, Sekunden und Sekundenbruchteile gesplittet ist.</li><li>Der <b>Kalender</b> steht für verschieden Kalenderdaten wie Jahr, Monat, einen Wochentag oder den n-ten Tag einer Woche.</li><li>Eine <b>Zeitzone</b> (time-zone) repräsentiert die Zeit bezogen auf ein geografisches Gebiet.</li></ul></div>
<div class="text">Im Wesentlichen basiert die Zeitzonenfunktionalität (C++20) auf der Kalenderfunktionalität (C++20) und die Kalenderfunktionalität (C++20) auf der ursprünglichen chrono-Funktionalität (C++11).</div>
<div class="text">Das ist jedoch bei Weitem nicht alles. Die Erweiterung beinhaltet neue Zeitgeber. Mit der neuen Formatierungsbibliothek in C++20 lassen sich Zeitdauern ein- und auslesen.<br></div>
<div class="ztitel">Die Prototyp-Bibliothek date </div>
<div class="text">Zum jetzigen Zeitpunkt unterstützt kein C++ Compiler die chrono-Erweiterungen mit C++20. Dank der Prototyp-Bibliothek [code]<a href="https://github.com/HowardHinnant/date" alt="%7B%22user_params%22%3A%22%22%2C%22ir_link%22%3A1%2C%22custom%22%3A%7B%7D%2C%22text%22%3A%22date%5B%2Fcode%5D%22%2C%22version%22%3A1%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22alias%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22type%22%3A%22E%22%7D" title="Link auf https://github.com/HowardHinnant/date" class="">date[/code]</a> von Howard Hinnant, die die neuen chrono-Erweiterungen umfasst, lässt sich die neue Funktionalität bereits verwenden. Die Bibliothek ist iauf GitHub gehostet. Es gibt eine paar Möglichkeiten diese <a title="Link auf https://github.com/HowardHinnant/date" class="" href="https://github.com/HowardHinnant/date" alt="%7B%22text%22%3A%22date%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22ir_link%22%3A1%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22target%22%3A%22_blank%22%2C%22type%22%3A%22E%22%2C%22anchor%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22version%22%3A1%2C%22alias%22%3A%22%22%7D">date</a>-Bibliothek zu verwenden:</div>
<div class="text"><ol><li> Du kannst die Bibliothek auf wandbox einsetzen. Howard hat die Headerdatei <span class="tx_code">date.h</span>, die für die Verwendung von <span class="tx_code">std::time_of_day</span> und die Kalenderdatentypen ausreichend ist, hochgeladen. Hier ist sein Link: <a href="https://wandbox.org/permlink/L8MwjzSSC3fXXrMd" alt="%7B%22ir_link%22%3A1%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22text%22%3A%22Try%20it%20out%20on%20wandbox%21%22%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22https%3A%2F%2Fwandbox.org%2Fpermlink%2FL8MwjzSSC3fXXrMd%22%2C%22version%22%3A1%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22https%3A%2F%2Fwandbox.org%2Fpermlink%2FL8MwjzSSC3fXXrMd%22%2C%22target%22%3A%22_blank%22%7D" class="" title="Link auf https://wandbox.org/permlink/L8MwjzSSC3fXXrMd">Try it out on wandbox!</a></li><li>Kopiere die Header-Datei <span class="tx_code">date.h</span> in den Suchpfad deines C++-Compilers.</li><li>Lade das Projekt herunter und baue es. Die bereits zitierte GibHub-Seite <a title="Link auf https://github.com/HowardHinnant/date" class="" href="https://github.com/HowardHinnant/date" alt="%7B%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22version%22%3A1%2C%22type%22%3A%22E%22%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22ir_link%22%3A1%2C%22user_params%22%3A%22%22%2C%22text%22%3A%22date%22%7D">date</a> enthält die notwendige Information dazu.</li></ol></div>
<div class="text">Ich habe meine ersten Gehversuche mit dem Online-Compiler unternommen und bin relativ schnell zur Strategie 2 gewechselt.</div>
<div class="ztitel">Notwendiger C++-Standard</div>
<div class="text">Im Allgemeinen ist ein C++14-Compiler ausreichend, um die <span class="tx_code">date</span>-Bibliothek zu verwenden. Es gibt eine Ausnahme dieser Regel, die ich mit dem folgenden Aufruf erfahren habe:</div>
<div class="pre">auto timeOfDay = date::time_of_day(10.h + 98min + 2020s + 0.5s); // C++20<br><br>auto timeOfDay = date::hh_mm_ss(10.h + 98min + 2020s + 0.5s);&nbsp;&nbsp;&nbsp; // C++17<br></div>
<div class="text">Ich verwendete in meinen ersten Gehversuchen die erste Zeile. Die erste Zeile setzt Bestimmung der Argumente eines Klassen-Templates für Alias-Templates vor. <span class="tx_code">time_of_day</span> ist ein Alias für <span class="tx_code">hh_mm_ss</span>: <span class="tx_code">using time_of_day_day = hh_mm_ss&lt;Duration&gt;</span>. Wird nun anstelle des Alias das Klassen-Template wie in der zweiten Zeile direkt verwendet, ist ein C++17-Compiler ausreichend. Er kann automatisch die Template-Argumente eines Klassen-Templates ermitteln. </div>
<div class="text">Hier gibt es mehr Details zur automatischen Bestimmung der Template-Argumente eines Klassen-Templates in C++17: <a href="https://www.grimm-jaud.de/index.php/blog/c-17-kern" alt="%7B%22type%22%3A%22E%22%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22https%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Fc-17-kern%22%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22https%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Fc-17-kern%22%2C%22version%22%3A1%2C%22text%22%3A%22C%2B%2B17%3A%20Was%20gibt%27s%20Neues%20in%20der%20Kernsprache%3F%22%2C%22custom%22%3A%7B%7D%2C%22ir_link%22%3A1%2C%22user_params%22%3A%22%22%7D" class="" title="Link auf https://www.grimm-jaud.de/index.php/blog/c-17-kern">C++17: Was gibt's Neues in der Kernsprache?</a> <br></div>
<div class="ztitel"><b>Problem gelöst</b></div>
<div class="text">Mit C++20 wurde <span class="tx_code">time_of_day</span> in <span class="tx_code">hh_mm_ss</span> umbenannt. Howard Hinnant gab mir den entscheidenden Hinweis: </div>
<div class="einrueckung">"Prefer to use hh_mm_ss in place of time_of_day. time_of_day got renamed to hh_mm_ss during the standardization process for C++20, and so time_of_day remains strictly as a backwards compatible shim for current and past users of this lib."</div>
<div class="text">Dies war wieder eine für einen Early Adopter typische Odyssee.<br></div>
<div class="ztitel">Portierung auf C++20</div>
<div class="text">Wenn nur die Bestandteile der <span class="tx_code">date</span>-Bibliothek zum Einsatz kommen, die Bestandteil des C++20-Standards sind, ist die Portierung der Beispiele auf C++20 keine große Herausforderung. Ersetze zum einen die Header-Dateien der Prototyp-Biblitothek <a alt="%7B%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22alias%22%3A%22%22%2C%22version%22%3A1%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22type%22%3A%22E%22%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22custom%22%3A%7B%7D%2C%22ir_link%22%3A1%2C%22user_params%22%3A%22%22%2C%22text%22%3A%22date%22%7D" href="https://github.com/HowardHinnant/date" class="" title="Link auf https://github.com/HowardHinnant/date">date</a> mit der <span class="tx_code">&lt;chrono&gt;</span>-Header-Datei und ersetze zum anderen den Namensraum <span class="tx_code">date</span> mit dem Namensraum <span class="tx_code">std::chrono</span>:<br></div>
<div class="pre">#include "date.h"&nbsp;&nbsp; &nbsp;<br>//#include &lt;chrono&gt;<br><br>int main() {<br><br>&nbsp;&nbsp;&nbsp;&nbsp; using namespace std::chrono_literals;<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp; auto am = date::is_am(10h);&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp; // auto am = std::chrono::is_am(10h); &nbsp;<br><br>}</div>
<div class="text">Jetzt beginne ich über die chrono-Erweiterungen in C++20 zu schreiben.</div>
<div class="ztitel">Tageszeit</div>
<div class="text"><span class="tx_code">std::chrono::hh_mm_ss</span> ist die Zeitdauer seit Mitternacht, die in Stunden, Minuten, Sekunden und Sekundenbruchteile gesplittet ist. Dieser Datentyp wird gerne zum Formatieren verwendet. Zuerst einmal gibt die folgende Tabelle einen kompakten Überblick des neuen Datentyps&nbsp; <span class="tx_code">std::chrono::hh_mm_ss. tOfDay</span> ist eine Instanz dieses Typs. <br></div>
<div class="text"><span class="tx_code"><img class="rteInlinetag" src="https://heise-cms.de/thumbs//2/9/9/0/7/9/8/TN_201483773_a730a78454.png" title="<ir_inline itemname=bilder_mvp_bild_var2:2 type=2>" style="max-height: 25px; max-width: 25px;"><br></span></div>
<div class="text">Das folgende Programm wendet die Funktionen an:</div>
<div class="pre">// timeOfDay.cpp<br><br>#include "date.h"<br>#include &lt;iostream&gt;<br><br>int main() {<br>&nbsp; using namespace date;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (3)<br>&nbsp; using namespace std::chrono_literals;<br><br>&nbsp; std::cout &lt;&lt; std::boolalpha &lt;&lt; std::endl;<br>&nbsp;&nbsp; &nbsp;<br>&nbsp; auto timeOfDay = date::hh_mm_ss(10.5h + 98min + 2020s + 0.5s);&nbsp;&nbsp;&nbsp;&nbsp; // (1)<br>&nbsp;&nbsp; &nbsp;<br>&nbsp; std::cout&lt;&lt; "timeOfDay: " &lt;&lt; timeOfDay &lt;&lt; std::endl;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2)<br><br>&nbsp; std::cout &lt;&lt; std::endl;<br><br>&nbsp; std::cout &lt;&lt; "timeOfDay.hours(): " &lt;&lt; timeOfDay.hours() &lt;&lt; '\n';&nbsp;&nbsp;&nbsp;&nbsp; // (4)<br>&nbsp; std::cout &lt;&lt; "timeOfDay.minutes(): " &lt;&lt; timeOfDay.minutes() &lt;&lt; '\n'; // (4)<br>&nbsp; std::cout &lt;&lt; "timeOfDay.seconds(): " &lt;&lt; timeOfDay.seconds() &lt;&lt; '\n'; // (4)<br>&nbsp; std::cout &lt;&lt; "timeOfDay.subseconds(): " &lt;&lt; timeOfDay.subseconds() &lt;&lt; '\n';&nbsp;&nbsp;&nbsp;&nbsp; // (4)<br>&nbsp; std::cout &lt;&lt; "timeOfDay.to_duration(): " &lt;&lt; timeOfDay.to_duration() &lt;&lt; '\n';&nbsp;&nbsp; // (5)<br><br>&nbsp; std::cout &lt;&lt; std::endl;<br><br>&nbsp; std::cout &lt;&lt; "date::hh_mm_ss(45700.5s): " &lt;&lt; date::hh_mm_ss(45700.5s) &lt;&lt; '\n'; // (6)<br><br>&nbsp; std::cout &lt;&lt; std::endl;<br><br>&nbsp; std::cout &lt;&lt; "date::is_am(5h): " &lt;&lt; date::is_am(5h) &lt;&lt; std::endl;&nbsp;&nbsp;&nbsp; // (7) &nbsp;<br>&nbsp; std::cout &lt;&lt; "date::is_am(15h): " &lt;&lt; date::is_am(15h) &lt;&lt; std::endl;&nbsp; // (7)<br><br>&nbsp; std::cout &lt;&lt; std::endl;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp; std::cout &lt;&lt; "date::make12(5h): " &lt;&lt; date::make12(5h) &lt;&lt; std::endl;&nbsp;&nbsp; // (7)&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp; std::cout &lt;&lt; "date::make12(15h): " &lt;&lt; date::make12(15h) &lt;&lt; std::endl; // (7)<br>&nbsp; <br>&nbsp; std::cout &lt;&lt; std::endl;<br>&nbsp; <br>}</div>
<div class="text">In Zeile 1 erzeuge ich eine neue Instanz von <span class="tx_code">std::chrono::hh_mm_ss: timeOfDay</span>. Dank der chrono-Literale aus C++14 lassen sich ein paar Zeitdauern zu dem Tageszeitobjekt hinzuaddieren und es damit zu initialisieren. Mit C++20 lässt sich <span class="tx_code">timeOfDay</span> (Zeile 2) direkt ausgeben. Genau aus diesem Grund muss ich in Zeile 3 den Namensraum <span class="tx_code">date</span> bekannt machen. Der Rest des Programms sollte einfach zu lesen sein. Die Zeilen (4) gibt die Komponenten der Zeitdauer seit Mitternacht in Stunden, Minuten, Sekunden und Sekundenbruchteilen zurück. Zeile (5) gibt die Zeitdauer seit Mitternacht in Sekunden zurück. Die Zeile (6) ist interessanter: Die übergebenen Sekunden entsprechen der Zeit, die in Zeile (2) dargestellt wird. Zeile (7) beantwortet die Frage, ob die gegebene Zeit a.m. ist. Zeile (8) gibt schließlich das 12-Stunden-Äquivalent der gegebenen Stunde zurück.<br></div>
<div class="text">Dank der <a alt="%7B%22text%22%3A%22date%22%2C%22custom%22%3A%7B%7D%2C%22ir_link%22%3A1%2C%22user_params%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22alias%22%3A%22%22%2C%22version%22%3A1%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FHowardHinnant%2Fdate%22%7D" href="https://github.com/HowardHinnant/date" class="" title="Link auf https://github.com/HowardHinnant/date">date</a>-Bibliothek lässt sich das Programm ausführen.</div>
<div class="text"><img class="rteInlinetag" src="https://heise-cms.de/thumbs//2/9/9/0/7/9/8/TN_201483778_edc8610249.png" title="<ir_inline itemname=bilder_mvp_bild_var2:4 type=2>" style="max-height: 25px; max-width: 25px;"></div>
<div class="ztitel">Wie geht's weiter? </div>
<div class="text">In meinen nächsten Artikel stelle ich die nächste Komponente der chrono-Erweiterung vor: Kalender.<br></div>